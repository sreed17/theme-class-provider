import e,{createContext as r,useReducer as t,useMemo as s,useEffect as a,useContext as n}from"react";import{produce as o}from"immer";const l=r(null);function c(e){return!!Array.isArray(e)&&e.every((e=>"string"==typeof e))}function i(e){return!(!e||"object"!=typeof e)&&(null!=e&&"object"==typeof e&&"theme_classes"in e&&c(e.theme_classes)&&"current"in e&&function(e,r){return"number"==typeof e&&e>=0&&e<r}(e.current,e.theme_classes.length))}function u(e){try{localStorage.removeItem(e)}catch(e){console.error("Error clearing persisted theme data:",e)}}function d(e,r){return(e%r+r)%r}function E(e,r){return o(e,(e=>{if(!function(e,r){switch(e){case"SET_CURRENT_THEME_CLASS":case"SET_DEFAULT":return"string"==typeof r;case"SET_LOADING_STATE":case"FLAG_PERSISTED_DATA_LOAD":return"boolean"==typeof r;case"SET_THEME_CLASSES":return c(r);case"TOGGLE_THEME":return null==r||void 0===r;case"LOAD_STATE":return i(r)}return!1}(r.type,r.payload)){const r=new Error("Type Error: Invalid ThemeClassAction type, Check the dispatched action object");return e.error=r,e}const t=r.type;switch(e.error=null,t){case"SET_LOADING_STATE":e.is_loading=r.payload;break;case"SET_THEME_CLASSES":if(0===r.payload.length){const r=new Error("Value Error: Theme-classes list must not be empty");return e.error=r,e}e.theme_classes=r.payload,e.previous=null,e.current=0;break;case"SET_CURRENT_THEME_CLASS":{const t=e.theme_classes.indexOf(r.payload);if(-1===t){const r=new Error("Invalid Value Error: Can't set to the proveded theme-class since it does not exist in the theme-classes list");e.error=r;break}e.previous=e.current,e.current=t;break}case"TOGGLE_THEME":{const r=e.theme_classes.length,t=e.current;e.previous=t;const s=t+1>=r?0:t+1;e.current=s;break}case"LOAD_STATE":{const{current:t,theme_classes:s}=r.payload;e.previous=null,e.current=t,e.theme_classes=s;break}case"SET_DEFAULT":{const t=e.theme_classes.indexOf(r.payload);if(-1===t){const r=new Error("Invalid Value Error: Can't set to the proveded theme-class since it does not exist in the theme-classes list");e.error=r;break}const s=[],a=e.theme_classes.length;for(let r=0;r<a;r++){const n=r-t,o=n<0?d(n,a):n;s[o]=e.theme_classes[r],r===e.previous&&(e.previous=o)}e.theme_classes=s,e.current=0;break}case"FLAG_PERSISTED_DATA_LOAD":e.loaded_persisted_data=r.payload}return e}))}const h={key:"theme-data",disabled:!1,clearOnUnload:!1},_=({themeClasses:r,children:n,persist:o,onChange:c,defaultTheme:d})=>{const _={...h,...o};if(0===r.length)throw new Error("Value Error: Theme-classes list must not be empty");const m={previous:null,current:0,is_loading:!0,theme_classes:r,error:null,loaded_persisted_data:!1},[T,p]=t(E,m),y=s((()=>({current:T.current,theme_classes:T.theme_classes})),[T.current,T.theme_classes]),S=s((()=>_.key),[_.key]),A=e=>{p({type:"LOAD_STATE",payload:e})},f=e=>{p({type:"SET_DEFAULT",payload:e})};a((()=>{const{key:e}=_,r=function(e){try{const r=localStorage.getItem(e);if(!r)return null;const t=JSON.parse(r);return i(t)?t:null}catch(e){return console.error("Error retrieving persisted theme data:",e),null}}(e);return r?(A(r),p({type:"FLAG_PERSISTED_DATA_LOAD",payload:!0})):null!=d&&f(d),(e=>{p({type:"SET_LOADING_STATE",payload:e})})(!1),()=>{(_.clearOnUnload||_.disabled)&&u(e)}}),[]),a((()=>{T.is_loading||_.disabled||(!function(e,r){try{localStorage.setItem(e,JSON.stringify(r))}catch(e){console.error("Error setting persisted theme data:",e)}}(S,y),c&&c(T.current,T.previous,T.theme_classes))}),[T]);const g={is_loading:T.is_loading,error:T.error,loaded_persisted_data:T.loaded_persisted_data,setCurrentTheme:e=>{p({type:"SET_CURRENT_THEME_CLASS",payload:e})},getCurrentTheme:()=>T.theme_classes[T.current],toggleTheme:()=>{p({type:"TOGGLE_THEME",payload:void 0})},setThemeClasses:e=>{p({type:"SET_THEME_CLASSES",payload:e})},getThemeClasses:()=>T.theme_classes,loadState:A,clearPersistedThemeData:()=>{u(_.key)},setDefault:f};return e.createElement(l.Provider,{value:g},n)};_.defaultProps={persist:{},defaultTheme:null,onChange:function(e,r,t){try{if(null!==r){const e=t[r];document.documentElement.classList.remove(e)}const s=t[e];document.documentElement.classList.add(s)}catch(e){console.error("Error changing the document theme class")}}};const m=()=>{const e=n(l);if(!e)throw new Error("Error: Theme-class-context is null. Make sure the you are using the ThemeClassProvider correctly.");return e};export{_ as ThemeClassProvider,m as useThemeClass};
//# sourceMappingURL=index.mjs.map
